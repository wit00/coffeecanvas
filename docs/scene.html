<!DOCTYPE html>  <html> <head>   <title>scene.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="collisionResponse.html">                 collisionResponse.coffee               </a>                                           <a class="source" href="collisions.html">                 collisions.coffee               </a>                                           <a class="source" href="gameloop.html">                 gameloop.coffee               </a>                                           <a class="source" href="keys.html">                 keys.coffee               </a>                                           <a class="source" href="scene.html">                 scene.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               scene.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The scene class is a container class that holds the parent sprites (parent sprites hold sub-sprites)
and tells the parent sprites to draw and update. Scene also controls the canvas and related context elements
and passes references to the context to the parent sprites. Scene holds the parent sprites in an array.
The scene class primarly serves as a way to separate the sceneDirector from the Sprite class, maintaining the #distinction between the API and its implementation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Scene</span>
  <span class="nv">constructor: </span><span class="nf">(canvas,canvasWidth) -&gt;</span>
    <span class="vi">@canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span> <span class="s2">&quot;myCanvas&quot;</span>
    <span class="vi">@canvasWidth = </span><span class="nx">@canvas</span><span class="p">.</span><span class="nx">width</span>
    <span class="vi">@canvasHeight = </span><span class="nx">@canvas</span><span class="p">.</span><span class="nx">height</span>
    <span class="vi">@context = </span><span class="nx">@canvas</span><span class="p">.</span><span class="nx">getContext</span> <span class="s2">&quot;2d&quot;</span>
    <span class="vi">@sprites = </span><span class="p">[]</span>
    
  <span class="nv">draw: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">@sprites</span>
      <span class="nx">sprite</span><span class="p">.</span><span class="nx">runDrawing</span><span class="p">(</span><span class="nx">@context</span><span class="p">)</span>
      
  <span class="nv">update: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">@sprites</span>
      <span class="nx">sprite</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
   

  
    
  <span class="nv">addSprite: </span><span class="nf">(sprite) -&gt;</span>
    <span class="nx">@sprites</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sprite</span><span class="p">)</span>
  <span class="nx">addSprites</span><span class="o">:</span><span class="nf">(sprites...)-&gt;</span>
    <span class="nx">@sprites</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sprite</span><span class="p">)</span> <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">sprites</span>
    </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>removes a sprite and its children from the display list</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">removeSprite</span><span class="o">:</span><span class="nf">(sprite)-&gt;</span>
    <span class="nv">index = </span><span class="nx">@sprites</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">sprite</span><span class="p">)</span>
    <span class="nx">@sprites</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  
    <span class="nx">collisions</span><span class="p">.</span><span class="nx">unObserve</span><span class="p">(</span><span class="nx">sprite</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>collisions.removeSprite(sprite)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">removeChild</span><span class="o">:</span><span class="nf">(parentSprite,childSprite)-&gt;</span>
    <span class="nv">index = </span><span class="nx">parentSprite</span><span class="p">.</span><span class="nx">subSprites</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">childSprite</span><span class="p">)</span>
    <span class="nx">parentSprite</span><span class="p">.</span><span class="nx">subSprites</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>collisions.removeSprite(childSprite) #why don't I work?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">collisions</span><span class="p">.</span><span class="nx">unObserve</span><span class="p">(</span><span class="nx">childSprite</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>move this
from coffeescriptcookbook.com/chapters/  classes<em>and</em>objects/cloning</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clone: </span><span class="nf">(obj) -&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">obj</span><span class="o">?</span> <span class="o">or</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">isnt</span> <span class="s1">&#39;object&#39;</span>
      <span class="k">return</span> <span class="nx">obj</span>

    <span class="k">if</span> <span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">Date</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">getTime</span><span class="p">())</span> 

    <span class="k">if</span> <span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">RegExp</span>
      <span class="nv">flags = </span><span class="s1">&#39;&#39;</span>
      <span class="nx">flags</span> <span class="o">+=</span> <span class="s1">&#39;g&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">global</span><span class="o">?</span>
      <span class="nx">flags</span> <span class="o">+=</span> <span class="s1">&#39;i&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">ignoreCase</span><span class="o">?</span>
      <span class="nx">flags</span> <span class="o">+=</span> <span class="s1">&#39;m&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">multiline</span><span class="o">?</span>
      <span class="nx">flags</span> <span class="o">+=</span> <span class="s1">&#39;y&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">sticky</span><span class="o">?</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span> 

    <span class="nv">newInstance = </span><span class="k">new</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">obj</span>
      <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> 
        <span class="nx">newInstance</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@clone</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> 
        <span class="nx">newInstance</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> 

    <span class="k">return</span> <span class="nx">newInstance</span>
    

  <span class="nv">makeChild: </span><span class="nf">(parentSprite,childSprite) -&gt;</span>
    <span class="nx">parentSprite</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">childSprite</span><span class="p">)</span>
    <span class="nv">childSprite.adjustedX = </span><span class="nx">childSprite</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">parentSprite</span><span class="p">.</span><span class="nx">adjustedX</span>
    <span class="nv">childSprite.adjustedY = </span><span class="nx">childSprite</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">parentSprite</span><span class="p">.</span><span class="nx">adjustedY</span>

  <span class="nv">clear: </span><span class="o">=&gt;</span>
    <span class="nx">@context</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">@canvasWidth</span><span class="p">,</span><span class="nx">@canvasHeight</span><span class="p">)</span>
    
  <span class="nx">attachLinearGradientFill</span><span class="o">:</span><span class="nf">(sprite,gradient)-&gt;</span>
    <span class="nv">grad = </span><span class="nx">@context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">x1</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">y1</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">x2</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">y2</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>grad = @context.createLinearGradient(0,0,0,100)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">grad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">gradient</span><span class="p">.</span><span class="nx">colorStops</span>
    <span class="nv">sprite.fill = </span><span class="nx">grad</span>
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">createStamp</span><span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">stampContext</span><span class="p">)</span>
    
  <span class="nx">attachRadialGradientFill</span><span class="o">:</span><span class="nf">(sprite,gradient)-&gt;</span>
    <span class="nv">grad = </span><span class="nx">@context</span><span class="p">.</span><span class="nx">createRadialGradient</span><span class="p">(</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">x1</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">y1</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">r1</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">x2</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">y2</span><span class="p">,</span><span class="nx">gradient</span><span class="p">.</span><span class="nx">r2</span><span class="p">)</span>
    <span class="nx">grad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">gradient</span><span class="p">.</span><span class="nx">colorStops</span>
    <span class="nv">sprite.fill = </span><span class="nx">grad</span>
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">createStamp</span><span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">stampContext</span><span class="p">)</span>
  
  <span class="nx">attachPattern</span><span class="o">:</span><span class="nf">(sprite,pattern)-&gt;</span>
    <span class="nv">pat = </span><span class="nx">@context</span><span class="p">.</span><span class="nx">createPattern</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">imgId</span><span class="p">,</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">repeat</span><span class="p">)</span>
    <span class="nv">sprite.fill = </span><span class="nx">pat</span>
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">createStamp</span><span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">stampContext</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>ToDo: add backgrounds to the Scene to replace or augment the clear function</p>             </td>             <td class="code">               <div class="highlight"><pre>  

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 