<!DOCTYPE html>  <html> <head>   <title>sceneDirector.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="animations.html">                 animations.coffee               </a>                                           <a class="source" href="gameloop.html">                 gameloop.coffee               </a>                                           <a class="source" href="keys.html">                 keys.coffee               </a>                                           <a class="source" href="scene.html">                 scene.coffee               </a>                                           <a class="source" href="sceneDirector.html">                 sceneDirector.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sceneDirector.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>sceneDirector implements the API, and can be thought of as a main function
It uses a global fps variable for sprite velocities because the API doesn't have scene-by-scene animation yet.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">fps = </span><span class="mi">60</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Initialize the Scene, GameLoop and KeyManager.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">scene = </span><span class="k">new</span> <span class="nx">Scene</span>
<span class="nv">gameLoop = </span><span class="k">new</span> <span class="nx">GameLoop</span><span class="p">(</span><span class="nx">animations</span><span class="p">)</span>
<span class="nv">keys = </span><span class="k">new</span> <span class="nx">KeyManager</span>
<span class="nv">animations = </span><span class="k">new</span> <span class="nx">AnimationManager</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Add Event Listeners for the KeyManager</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,(</span><span class="nx">listener</span><span class="o">=</span><span class="nf">(event)-&gt;</span><span class="nx">keys</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">event</span><span class="p">)),</span><span class="kc">false</span><span class="p">)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keyup&quot;</span><span class="p">,(</span><span class="nx">listener</span><span class="o">=</span><span class="nf">(event)-&gt;</span><span class="nx">keys</span><span class="p">.</span><span class="nx">onKeyUp</span><span class="p">(</span><span class="nx">event</span><span class="p">)),</span><span class="kc">false</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Here are examples of Scene functions at work. Create some objects, add them to the scene and/or make them the #children of other objects</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">newSprite = </span><span class="k">new</span> <span class="nx">Sprite</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="mi">200</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mi">200</span><span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">addSprite</span> <span class="nx">newSprite</span>
<span class="nv">centerStar = </span><span class="k">new</span> <span class="nx">Star</span><span class="p">(</span><span class="nx">lineWidth</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span><span class="nx">velocity</span><span class="o">:</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="nx">fps</span><span class="p">,</span><span class="nx">radius</span><span class="o">:</span><span class="mi">30</span><span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">makeChild</span><span class="p">(</span><span class="nx">newSprite</span><span class="p">,</span> <span class="nx">centerStar</span><span class="p">)</span>
<span class="nv">gradient = </span><span class="k">new</span> <span class="nx">Gradient</span>
<span class="nx">gradient</span><span class="p">.</span><span class="nx">makeOptimalRadial</span><span class="p">(</span><span class="nx">centerStar</span><span class="p">)</span>

<span class="nv">circle1 = </span><span class="k">new</span> <span class="nx">Circle</span><span class="p">(</span><span class="nx">radius</span><span class="o">:</span><span class="mi">30</span><span class="p">,</span><span class="nx">x</span><span class="o">:</span><span class="mi">50</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mi">100</span><span class="p">,</span><span class="nx">alpha</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span><span class="nx">fill</span><span class="o">:</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="nx">lineWidth</span><span class="o">:</span><span class="mi">1</span><span class="p">)</span>
<span class="nv">circle2 = </span><span class="k">new</span> <span class="nx">Circle</span><span class="p">(</span><span class="nx">radius</span><span class="o">:</span><span class="mi">50</span><span class="p">,</span><span class="nx">x</span><span class="o">:</span><span class="mi">50</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mi">90</span><span class="p">,</span><span class="nx">alpha</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span><span class="nx">fill</span><span class="o">:</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="nx">lineWidth</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">velocity</span><span class="o">:</span><span class="mf">0.001</span><span class="p">)</span>
<span class="nv">circle3 = </span><span class="k">new</span> <span class="nx">Circle</span><span class="p">(</span><span class="nx">radius</span><span class="o">:</span><span class="mi">20</span><span class="p">,</span><span class="nx">x</span><span class="o">:</span><span class="mi">40</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mi">40</span><span class="p">,</span><span class="nx">alpha</span><span class="o">:</span><span class="mf">0.2</span><span class="p">,</span><span class="nx">fill</span><span class="o">:</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="nx">lineWidth</span><span class="o">:</span><span class="mi">1</span><span class="p">)</span>
<span class="nv">circle4 = </span><span class="k">new</span> <span class="nx">Circle</span><span class="p">(</span><span class="nx">radius</span><span class="o">:</span><span class="mi">80</span><span class="p">,</span><span class="nx">x</span><span class="o">:</span><span class="mi">350</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mi">200</span><span class="p">,</span><span class="nx">alpha</span><span class="o">:</span><span class="mf">0.6</span><span class="p">,</span><span class="nx">fill</span><span class="o">:</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="nx">lineWidth</span><span class="o">:</span><span class="mi">1</span><span class="p">)</span>
<span class="nv">circle5 = </span><span class="k">new</span> <span class="nx">Circle</span><span class="p">(</span><span class="nx">radius</span><span class="o">:</span><span class="mi">40</span><span class="p">,</span><span class="nx">x</span><span class="o">:</span><span class="mi">280</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mi">350</span><span class="p">,</span><span class="nx">alpha</span><span class="o">:</span><span class="mf">0.6</span><span class="p">,</span><span class="nx">fill</span><span class="o">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="nx">lineWidth</span><span class="o">:</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">addSprite</span><span class="p">(</span><span class="nx">circle1</span><span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">addSprite</span><span class="p">(</span><span class="nx">circle2</span><span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">addSprite</span><span class="p">(</span><span class="nx">circle3</span><span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">addSprite</span><span class="p">(</span><span class="nx">circle4</span><span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">addSprite</span><span class="p">(</span><span class="nx">circle5</span><span class="p">)</span>


<span class="nx">scene</span><span class="p">.</span><span class="nx">attachRadialGradientFill</span><span class="p">(</span><span class="nx">centerStar</span><span class="p">,</span><span class="nx">gradient</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Add keyboard and animationfunctionality. Sprite(s) subscribe to the KeyManager. Add events to sprites. 
To use functions that have parameters as parameters, you need to make them anonymous functions. 
the best way I've found to do this is to use a wrapper function, such as 
f=(x,y,z)->classInstance.function(x,y,z). There might be a better way to do this.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>user-defined animation event</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Sprite</span><span class="o">::</span><span class="nx">bounce</span><span class="o">=</span><span class="nf">(x,y)-&gt;</span>
  <span class="nx">randomNumber</span><span class="o">=</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">11</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span><span class="mi">370</span> <span class="o">or</span> <span class="nx">@y</span> <span class="o">&lt;=</span> <span class="mi">30</span> <span class="o">or</span> <span class="nx">@x</span> <span class="o">&gt;=</span><span class="mi">370</span> <span class="o">or</span> <span class="nx">@x</span> <span class="o">&lt;=</span><span class="mi">30</span>
    <span class="vi">@velocity = </span><span class="nx">@velocity</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
    <span class="nv">randomNumber = </span><span class="nx">randomNumber</span><span class="o">*-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">randomNumber</span> <span class="o">&gt;</span> <span class="mi">5</span>
    <span class="nx">@rotate</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="err">/10)*randomNumber)*@rotationVelocity</span>
  <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">+</span> <span class="nx">x</span><span class="o">*</span><span class="p">(</span><span class="nx">x</span><span class="err">/(@velocity*@time))</span>
  <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">+</span> <span class="nx">y</span><span class="o">*</span><span class="p">(</span><span class="nx">y</span><span class="err">/(@velocity*@time))</span>
  
<span class="nx">animations</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">newSprite</span>
<span class="nx">animations</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">circle1</span>
<span class="nx">animations</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">circle2</span>
<span class="nx">animations</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">circle3</span>
<span class="nx">animations</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">circle4</span>
<span class="nx">animations</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">circle5</span>
<span class="nx">keys</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">circle2</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>colorTween1 = new colorTween(0,0,0,1,0,0,0,1,6000)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">tween1 = </span><span class="k">new</span> <span class="nx">Tween</span><span class="p">(</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span><span class="nx">None</span><span class="p">.</span><span class="nx">easeNone</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">6.28</span><span class="p">,</span><span class="mi">5900</span><span class="p">)</span>
<span class="nx">circle1</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="nx">type</span><span class="o">:</span><span class="s2">&quot;animation&quot;</span><span class="p">,</span><span class="nx">toDo</span><span class="o">:</span><span class="p">(</span><span class="nx">f</span><span class="o">=</span><span class="nf">()-&gt;</span><span class="nx">circle1</span><span class="p">.</span><span class="nx">bounce</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">)))</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>circle2.addEvent("animation",87,(f=(x,y,z)->circle2.tween("alpha",circle2.alpha,1)))</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">circle2</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="nx">type</span><span class="o">:</span><span class="s2">&quot;tween&quot;</span><span class="p">,</span><span class="nx">toDo</span><span class="o">:</span><span class="nx">tween1</span><span class="p">)</span>
<span class="nx">newSprite</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="nx">type</span><span class="o">:</span><span class="s2">&quot;tween&quot;</span><span class="p">,</span><span class="nx">toDo</span><span class="o">:</span><span class="nx">tween1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>circle1.addEvent("animation",87,(f=(x,y)->bounce(circle1,0,-4)))
circle2.addEvent("animation",87,(f=(x,y)->bounce(circle2,0,-2)))
circle3.addEvent("animation",87,(f=(x,y)->bounce(circle3,0,4)))
circle4.addEvent("animation",87,(f=(x,y)->bounce(circle4,0,-1)))
circle5.addEvent("animation",87,(f=(x,y)->bounce(circle5,0,3)))</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">circle2</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="nx">type</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">],</span><span class="nx">code</span><span class="o">:</span><span class="mi">87</span><span class="p">,</span><span class="nx">toDo</span><span class="o">:</span><span class="p">(</span><span class="nx">f</span><span class="o">=</span><span class="nf">(x,y)-&gt;</span><span class="nx">circle2</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>circle2.addEvent(type:"animation",toDo:(f=()->circle2.bounce(0,-4)))
newSprite.addEvent("animation",87,(f=(x,y)->bounce(newSprite,0,-3)))
newSprite.addEvent(["keydown", "keyup"],87,(f=(x,y)->bounce(0,-20)))
newSprite.addEvent(["keydown", "keyup"],65,(f=(x,y)->newSprite.translate(-20,0)))
newSprite.addEvent(["keydown", "keyup"],68,(f=(x,y)->newSprite.translate(20,0)))
newSprite.addEvent(["keydown", "keyup"],83,(f=(x,y)->newSprite.translate(0,20)))</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>toDo: replace the fps global variable with flash style scene animation
toDo: add mouse functionality</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 